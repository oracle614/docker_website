{% extends "base.html" %}
{% block title %}Import Page | Klorofil - Docker Manager System{% endblock %}
{% block main %}
    <!-- MAIN CONTENT -->
    <div class="main-content" >
        <div class="container-fluid">
{#            <div class="row">#}
            <div class="col-md-12">
                <br>
                <div class="panel panel-scrolling">
                    <div class="panel-heading">
                        <h3 class="panel-title">主节点镜像文件</h3>
                        <div class="right">
                            <button type="button" class="btn-toggle-collapse"><i class="lnr lnr-chevron-up"></i></button>
                            <button type="button" class="btn-remove"><i class="lnr lnr-cross"></i></button>
                        </div>
                    </div>
                    <div class="panel-body no-padding">
                        <form action="#" method="post">
                        <table class="table table-condensed">
                            <thead>
                            <tr>
                                <th>文件编号</th>
                                <th>镜像文件名</th>
                                <th>创建时间</th>
                                <th>大小</th>
                                <th>导入</th>
                            </tr>
                            </thead>
                            <tbody id="image_file_list">
                            </tbody>
                        </table>
                        </form>
                    </div>
                    <div class="panel-footer">
                        <!--
                        <form class="form-horizontal">
                        -->
                        <div class="form-group">
                            <form class="form-horizontal">
                                <div class="row">
                                    <label class="control-label col-md-1">
                                        节点
                                    </label>
                                    <div class="col-md-5" id="select_parent">
                                        <select id="node_list" class="selectpicker form-control" multiple>
                                        </select>
                                    </div>
                                    <div class="col-md-4"> </div>
{#                                    <div class="col-md-6"></div>#}
                                    <div class="col-md-2">
                                        <button class="btn btn-primary" type="button" id="import_button">
                                            <i class="fa fa-spinner fa-spin" id="loading"></i>
                                            Loading
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
<!-- private js start -->
{% block script %}
    <script>
        /* get node list start */
        $(document).ready(function () {
           $.ajax({
                data: JSON.stringify({'type': 'node_list'}),
                dataType: 'json',
                type: 'POST',
                contentType: 'application/json; charset=UTF-8',
                url: '{{ url_for('get_import_info') }}',
                success: function (resful, status) {
                    if(status) {
                        var node_list = resful.node_list;
                        for(var i=0; i<node_list.length; i++) {
                            var option = document.createElement('option');
                            option.setAttribute('selected', true);
                            option.setAttribute('value', node_list[i]);
                            option.innerText = node_list[i];
                            $("#node_list").append(option);
                        }
                        $("#node_list").selectpicker("refresh");
                    }
                }
           });
        });
        /* get node list end */
        /* get tar file list start */
        $(document).ready(function () {
           $.ajax({
                data: JSON.stringify({'type': 'image_file_list'}),
                dataType: 'json',
                type: 'POST',
                contentType: 'application/json; charset=UTF-8',
                url: '{{ url_for('get_import_info') }}',
                success: function (resful, status) {
                    if(status) {
                        var button = document.getElementById('import_button');
                        button.innerHTML = '导出';
{#                        var div1 = button.parentNode;#}
{#                        var div2 = button.previousSibling;#}
{#                        div1.setAttribute('class', 'col-md-1');#}
{#                        div2.setAttribute('class', 'col-md-5');#}
                        var image_file_list = resful.image_file_list;
                        make_tar_format(image_file_list);
                    }
                }
           });
        });
        /* get image file list end */
        /* make image list start */
        function make_tar_format(data) {
            /*
            * data format:
            * example:[[id, file_name, create_time, size], ...]
            *
            * */
            image_list = document.getElementById('image_file_list');
            for(var i =0; i<data.length; i++) {
                var row = document.createElement('tr');
                for(var j=0; j<data[i].length;j++) {
                   var num = document.createElement('td');
                   num.innerText = data[i][j];
                   row.appendChild(num);
                   if(j === data[i].length - 1) {
                       var temp = document.createElement('td');
                       var checkbox = document.createElement('input');
                       checkbox.setAttribute("type", "checkbox");
                       checkbox.checked = true;
                       temp.appendChild(checkbox);
                       row.appendChild(temp);
                   }
                }
                image_list.appendChild(row);
            }
        }
        /* make image list end */
    </script>
{% endblock %}
<!-- private js stop -->